
Check out README.md for a concise version of this.
This document adds some thoughts and details, but README.md is good enough if You just want to build a version of the binding


(windows) : 

TightDB developer : 

has windows 7 and VS2012  ultimate installed in newest versions
builds tightdb core static libaries (manually, no documentation exists)
uses winrelease.cmd to make tightdb c++ binding static library release (static library .lib files and header files)


TightDB C# language binding developer (tightdb c dll part ):

has windows 7 and VS2012 ultimate installed in newest versions
uses tightdb c++ static binding release
builds a set of c dll files which contains tightdb C API for the C# language binding
uses build.cmd to make a tightdb c dll release (various dll files,debug/release/32/64bit)

TightDB language binding developer (C# part)
has windows 7 and VS2012 ultimate installed in newest versions
(VS2012 express is sufficient for C# builds, but unit tests and code analysis and profiling is not supported in the free version, so 3rdparty stuff is needed.)
builds C# assembly, which contains binding API library to be used by customer .net developers
uses build.cmd to create c# assembly release, meant to be used by customer C# and .net developers
only uses c dll's for running usecases and for testing. c dll is not used to build the C# part of the binding itself

customer developer using tightdb C# .net language binding
has at least VS2012 express C# installed, and windows 7 - new versions
uses our C# API library
-our C# API library must include stuff so that the customer developer can debug and run on his own machine, even though he has no VS2012 c++ compiler installed
Builds his own application
creates his own application release, which must contain enough stuff so that his own application can run (C# and .net stuff) , as well as our binding (C# and c++ stuff) we have to supply him with files and documentation on how to to add whatever is needed by our c++ dll and our assembly to get them working. We need to test if anything is needed, like c++ runtime libraries for vs2012 c++


end customer
Has windows 7
installs customer developers' deployment
runs customer developers program, which in turn calls our assembly which in turn calls our c++ dll.
we should inform our customer developer how to correctly deploy anything we ourself depend upon.



End customer do not have VS installed, do not neccesarily have .net installed, do not neccessarily have an english windows, could run 32 or 64 bits, or in a virtual box. Probably runs a configuration very different from custom developer. Do not have pkzip or rar installed.

As we don't really control the method of deployment from customer developer to end customer, we should try to leave all options open for customer developer regarding method of deployment. It would be nice if we leave customer developer with just the raw files needed for deployment, as well as a few tips as how to do it easily, given he has VS2012

The procedure below is a file-only solution to all deployments above. 



This will likely be the base for creating more advanced kinds of deployments. It is work in progress, and does not handle all situations, for example installation of c++ reddistributables that are neccessary for customer developer to install, if he only has VS2012 C# express and no c++. 

config lib info

todo : batch fil der laver 3 pakker til customer developer
todo : build time valg af dll filnavn sæt udfra den compiler der builder
todo : generelt eliminer så meget som muligt manuelt.
todo : fjern diverse filer fra arkiver som ikke skal bruges.
todo : anvisninger til customer developer vedr. at få installeret c++ redistributables så han kan køre uden at have VS2012 c++ installeret
todo : anvisninger til customer developer så han kan lave en distribution der ikke kræver at vs2012 c++ redistributables er installeret hos hans slutbruger
todo : VS2012 kan ikke installeres på windows vista, så vi understøtter pt ikke customer developers, der af en eller anden syg årsag udvikler på operativsystemer ældre end windows 7.




In general, where .sln files reside, we also have a buld.cmd file. The buld.cmd file can be run after a build, it creates a release of the solution, in the release\files and relase\release directories (release containing a zip file, files containing the files unzipped)


Total buld of the C# binding, inclusive of a build of tightdb core is described in step-1 until step-3

Test of this build with a hello world application is done in step-4 and step-5

Step-1  build VS2012 c++ static librlibraries with tightdb core and headerfiles

0) You need VS2012 better than VS2012 Express - express have toolset problems with 64 bit in c++ projects, therefore  core build will not work with certain vs2012 express installs (depending on SDK installs and seviceback installs)

1) check out master tightdb from github - place it in xyz\tightdb  (xyz is a path of Your own choice)

2) build the 4 static libraries in vs2012 :
* start VS2012 by right clicking xyz\tightdb\TightDB.sln
* In solution explorer, right click TightDB solution, choose update vc++ projects. click update.
* select menu->build->batch build, select the 4 static library tightdb builds, click clean
* select menu->build->batch build, select the 4 static library tightdb builds, click rebuild

3) run winrelease.cmd

* in windows explorer, double click winrelase.cmd

xyz\tightdb\release\vs2012\release will now contian the files we need to make the VS2012 c++ binding




step-2  build the c part of tightdb .net binding with VS2012 c++

xyz er det directory du normalt checker tightdb projekter ud i.

1) check out tightdb_csharp master, place it in xyz\tightdb_csharp

2) install the c++ binding distribution: extract the archive from step-1 3) inside the directory xyz\tightdb_csharp\libsVS2012

*a copy tightdb\release\vs2012\files\*.* to tightdb_csharp\libsVS2012\*.* (one optin)
*b or copy the .zip file from tightdb\release\vs2012\release\tightdb_cpp_VS2012___.zip to tightdb_csharp\libsVS2012\ and then extract it, by right clicking it and selecting extract here.

3) open xyz\tightdb_csharp\native\tightdb_c_cs2012\tightdb_c_cs2012.sln

4) build->batch build->mark the lowest 4 configurations, tightdb_c_cs2012 and click clean
build->batch build->marker the lowest 4 configurations, tightdb_c_cs2012 and click rebuild

5) run xyz\tightdb_csharp\native\tightdb_c_cs2012\release.cmd

directory xyz\tightdb_csharp\native\tightdb_c_cs2012\tightdb_c_cs2012\release\release will now contan a  release of the windows C dll tightdb interface - this interface can be used by almost all windows programs, in order to make a language specific binding.


step-3 build the tightdb_csharp part of the binding

in windows explorer, open xyz\tightdb_csharp\TightDbCSharp

1) open TightDbCSharp.sln

2) menu->build->batch build->mark both configurations->rebuild

3) run build.cmd in the same directory as where you opened TightDbCSharp.sln

after this, xyz\tightdb_csharp\TightDbCSharp\release\   will contain the C# binding distribution


(the rest is not in English, will be transalted in time)

Nu har du 3 arkiver :

A) c++ binding distributionen 
B) c API distributionen       
C) C# binding distributionen  




step-4 lav et testprojekt, svarende til hvis du havde et eksisterende projekt der skulle bruge tightdb


Denne gennemgang opretter et helt nyt C# console program i VS2012


1) lav tomt program

start VS2012 og vælg new project
vælg Other langauges->Visual C#
vælg Console  Application
vælg foreslåede placering, hvilket er et eller andet sted i dit windows user directory.


Sanity-check
Build->batch build og byg begge versioner (som begge er Any CPU)
klik på start for at køre den helt tomme applikation
et commandline vindue burde gerne dukke op meget kort tid,og forsvinde igen



2) udvid med en Hello, World agtig pause

(program.cs burde være fremme på skærmen, ellers ConsoleApplcation1->Program.CS i solution explorer)
tilføj følgende linie i Program.cs efter linien med { i static void Main 

            Console.WriteLine("Press any key to finish test... ");
            var ki = Console.ReadKey();


sanity-check
klik start og noter at nu bliver vinduet stående indtil man klikker på det og trykker en tast.
klik på programvinduet og tryk en tast for at lukke programmet igen






Så skal vi ha' brugt TightDB i vores projekt.




step-5 tilpas eksisternede projekt til at bruge tightdb

(dette eksempel fortsætter i VS2012 med programmet fra step-4)

1) højreklik ConsoleApplcation1 solution i solution explorer og vælg "open solution directory in explorer)

2) installer filer til brug for at benytte C# delen af bindingen

 i et andet explorer vindue finder du frem til arkiv C , som du lavede i step-3
det burde hedde Tightdb_csharp-bin-yyyy-mm-dd-hh-mm-builder.zip og det bør indeholde en træstruktur med filer i, hvor roden hedder bin.

pak hele arkivet ud i kataloget OVER det katalog der indeholder testprogrammet, eks hos mig er testprojektet 

C:\Users\wincoder\Documents\visual studio 2012\Projects\ConsoleApplication1
så pak ud i C:\Users\wincoder\Documents\visual studio 2012\Projects\



3) installer filer til brug for at C# bindingen kan kalde c++ bindingen

I andet (end ovenstående) explorer vindue finder du frem til arkiv B, som du lavede i step-2
det burde hedde noget i retning af tightdb_c_cs2012-2013-06-18-18-51-DFBUILD.rar

extract alle filer i arkivet der slutter på r.dll til kataloget consoleapplication1\bin\Release
extract alle filer i arkivet der slutter på d.dll til kataloget consoleapplication1\bin\debug

(dette vil snarst blive fixet i form af build og build-compiler-awareness i koden)
rename alle filerne du lige har kopieret, der slutter på 2012xxr i x64\release til ikke at indeholde 2012 og ikke at slutte på r
rename alle filerne du lige har kopieret, der slutter på d i x64\release til ikke at indeholde 2012 og ikke slutte på d


4) i ConsoleApplication højreklikker du references og vælger 
add reference
klik browse
naviger til ConsoleApplcation1\..\bin\debug  (vær forsigtig)  find TightDbCSharp.dll vælg den, klik add

5) sanity check. Vælg build->build all. skulle meget gerne stadig builde
6) sanity check. kør programmet. Det burde stadig køre præcist som før

7) tilføj i Program.cs
på linie 6 skriver du 
using TightDbCsharp
på linien før console.WriteLine("press any key to finish") skriver du :
            var t = new Table("test".Int());
            Console.WriteLine(t.Size);

8) nu kan du køre programmet, og det vil skrive 0 i linien over Press any key to finish test
Programmet kan køres både i debug og release mode.





step-6


deployment af eget program, som bruger tighdb C# binding :

1) hvis du vil installere dit smarte consoleapplication program et andet sted, kan du bare kopiere hele dit programs Debug eller hele dets Release katalog, og starte ConsoleApplication1.exe så virker det hele, maskinen skal blot have en version af .net installeret der er stor nok til at kunne køre programmet.
tightdb filerne er allerede at finde i dit debug eller release katalog.

Bemærk specielt at programmet kan køre på både 32 og 64 bit med samme exefil (med mindre du laver specifikke 32 og 64 bit builds - så skal du bare kopiere dll'erne ned i disse nye builds' output dirs, ved at gentage punkt 3


Jeg skal have checket tightdb c++ dll'erne for dependencies med STL library filer eller andet, som evt. også skal installeres med. Målet er slet ikke at have noget OS specifikt i C++ dll'en. Måske er vi allerede nået dertil. Dog ser det ud til at tightdb c++ binding bruger microsoft dll'er, som jeg ikke har helt styr på, om altid findes på en enduser maskine. Dette er egentlig i første omgang en opgave for c++ bindingen (at sikre at der er dokumentation for hvilke ting en pc skal have før den kan køre noget der bruger tightdb core libraries)

